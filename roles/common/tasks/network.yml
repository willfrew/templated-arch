---
- name: Install networking packages
  pacman:
    state: latest
    name:
      - openssh
      - openvpn
      - easy-rsa
      - gnu-netcat
      - tcpdump
      - traceroute
      - nmap
      - bind-tools # DNS utilities

- name: Install systemd-resolved config
  copy:
    src: resolved.conf
    dest: /etc/systemd/resolved.conf
    owner: root
    group: root

- name: Symlink /etc/resolv.conf to dynamic systemd-resolved config
  file:
    state: link
    src: /run/systemd/resolve/stub-resolv.conf
    dest: /etc/resolv.conf
    owner: root
    group: root
    mode: u=rw,g=r,o=r

- name: Install OpenVPN config files
  copy:
    src: openvpn/{{ item }}
    dest: /etc/openvpn/client/{{ item }}
    owner: root
    group: root
  with_items:
    - ca.crt
    - client.conf

- name: Ensure OpenVPN is reconnects after suspend
  copy:
    src: openvpn/openvpn-reconnect.service
    dest: /etc/systemd/system/openvpn-reconnect.service
    owner: root
    group: root

- name: Enable OpenVPN reconnect service
  systemd:
    name: openvpn-reconnect
    enabled: yes
    state: started
